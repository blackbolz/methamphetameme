<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Generator - METHAMPHETAMEME</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Metal+Mania&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a3d20, #0d4b2a, #1a5c3a, #267340, #2d7a4f, #4a9d6f, #52b788, #74c69d, #95d5b2);
            background-size: 400% 400%;
            animation: gradientShift 12s ease infinite;
            min-height: 100vh;
            padding: 20px;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(57, 255, 20, 0.3);
            color: #39ff14;
            padding: 12px 25px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(57, 255, 20, 0.2);
            border-color: #39ff14;
            transform: translateY(-2px);
        }

        .title {
            font-family: 'Metal Mania', cursive;
            font-size: clamp(2rem, 5vw, 4rem);
            color: #39ff14;
            text-shadow: 
                0 0 20px #39ff14,
                0 0 40px #39ff14,
                2px 2px 0px #000;
            margin-bottom: 20px;
            letter-spacing: 3px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            align-items: start;
        }

        /* Canvas Section */
        .canvas-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(57, 255, 20, 0.3);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 400px;
            margin: 0 auto 20px;
            border: 3px dashed rgba(57, 255, 20, 0.5);
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.2);
            overflow: hidden;
            cursor: crosshair;
        }

        .canvas-container.has-image {
            border-style: solid;
            cursor: default;
        }

        .user-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: none;
        }

        .upload-prompt {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #39ff14;
            font-size: 18px;
            font-weight: bold;
            pointer-events: none;
        }

        .upload-input {
            display: none;
        }

        .upload-button {
            background: linear-gradient(45deg, #39ff14, #32cd32);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(57, 255, 20, 0.5);
        }

        /* Overlay Element */
        .overlay-element {
            position: absolute;
            cursor: move;
            user-select: none;
            z-index: 10;
        }

        .overlay-element img {
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .overlay-element.selected {
            border: 2px solid #39ff14;
            box-shadow: 0 0 10px rgba(57, 255, 20, 0.5);
        }

        .resize-handle {
            position: absolute;
            bottom: -5px;
            right: -5px;
            width: 15px;
            height: 15px;
            background: #39ff14;
            border-radius: 50%;
            cursor: se-resize;
        }

        .rotate-handle {
            position: absolute;
            top: -15px;
            right: -5px;
            width: 15px;
            height: 15px;
            background: #ff6b35;
            border-radius: 50%;
            cursor: grab;
        }

        /* Controls Section */
        .controls-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(57, 255, 20, 0.3);
            border-radius: 20px;
            padding: 25px;
        }

        .controls-title {
            font-family: 'Metal Mania', cursive;
            font-size: 24px;
            color: #39ff14;
            text-shadow: 0 0 10px #39ff14;
            margin-bottom: 20px;
            text-align: center;
        }

        .png-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .png-button {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(57, 255, 20, 0.3);
            color: #39ff14;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
        }

        .png-button:hover {
            background: rgba(57, 255, 20, 0.2);
            border-color: #39ff14;
            transform: translateY(-2px);
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-button {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: #000;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }

        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .download-button {
            background: linear-gradient(45deg, #39ff14, #32cd32);
            color: #000;
            margin-top: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .canvas-container {
                height: 300px;
            }

            .controls-section {
                order: -1;
            }

            .png-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-button">‚Üê Back to Home</a>
        
        <div class="header">
            <h1 class="title">MEME GENERATOR</h1>
        </div>

        <div class="main-content">
            <div class="canvas-section">
                <button class="upload-button" onclick="document.getElementById('imageUpload').click()">
                     Upload Your Image
                </button>
                <input type="file" id="imageUpload" class="upload-input" accept="image/*" onchange="uploadImage(event)">
                
                <div class="canvas-container" id="canvasContainer">
                    <img class="user-image" id="userImage" alt="Uploaded image">
                    <div class="upload-prompt" id="uploadPrompt">
                        Click "Upload Your Image" to get started!
                    </div>
                </div>
            </div>

            <div class="controls-section">
                <div class="controls-title">Add Elements</div>
                
                <div class="png-buttons">
                    <!-- PNG OVERLAY BUTTONS - ADD YOUR PNG PATHS HERE -->
                    <button class="png-button" onclick="addOverlay('images/methicon.png', 'Meth')">
                        Meth
                    </button>
                    <button class="png-button" onclick="addOverlay('images-generator/walterwhite.png', 'Walter WHite')">
                        Walter
                    </button>
                    <button class="png-button" onclick="addOverlay('images/leftpipe.png', 'Meth pipe')">
                        Meth pipe
                    </button>
                    <button class="png-button" onclick="addOverlay('images/$meth.png', 'Ticker')">
                        Ticker
                    <button class="png-button" onclick="addOverlay('images-generator/money.png', 'Money')">
                        Cash
                    </button>
                    <button class="png-button" onclick="addOverlay('images-generator/greeneyes.png', 'Green eyes')">
                        Green eyes
                    </button>
                </div>

                <div class="action-buttons">
                    <button class="action-button" onclick="deleteSelected()" disabled id="deleteBtn">
                         Delete Selected
                    </button>
                    <button class="action-button" onclick="clearAll()" disabled id="clearBtn">
                         Clear All
                    </button>
                    <button class="action-button download-button" onclick="downloadMeme()" disabled id="downloadBtn">
                         Download now
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedElement = null;
        let overlayCounter = 0;
        let isDragging = false;
        let isResizing = false;
        let isRotating = false;
        let dragOffset = { x: 0, y: 0 };

        // Upload image functionality
        function uploadImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const userImage = document.getElementById('userImage');
                    const uploadPrompt = document.getElementById('uploadPrompt');
                    const canvasContainer = document.getElementById('canvasContainer');
                    
                    userImage.src = e.target.result;
                    userImage.style.display = 'block';
                    uploadPrompt.style.display = 'none';
                    canvasContainer.classList.add('has-image');
                    
                    // Enable buttons
                    document.getElementById('clearBtn').disabled = false;
                    document.getElementById('downloadBtn').disabled = false;
                };
                reader.readAsDataURL(file);
            }
        }

        // Add overlay element
        function addOverlay(imagePath, name) {
            const canvasContainer = document.getElementById('canvasContainer');
            const userImage = document.getElementById('userImage');
            
            if (!userImage.src) {
                alert('Please upload an image first!');
                return;
            }

            overlayCounter++;
            const overlay = document.createElement('div');
            overlay.className = 'overlay-element';
            overlay.id = `overlay-${overlayCounter}`;
            overlay.style.width = '80px';
            overlay.style.height = '80px';
            overlay.style.left = '50px';
            overlay.style.top = '50px';
            overlay.style.transform = 'rotate(0deg)';

            const img = document.createElement('img');
            img.src = imagePath;
            img.alt = name;
            img.onerror = function() {
                // Fallback if image doesn't exist
                this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjMzlmZjE0IiBvcGFjaXR5PSIwLjciLz4KPHRleHQgeD0iNDAiIHk9IjQ1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjMDAwIiBmb250LXNpemU9IjEyIiBmb250LXdlaWdodD0iYm9sZCI+' + btoa(name) + 'PC90ZXh0Pgo8L3N2Zz4K';
            };

            // Add resize handle
            const resizeHandle = document.createElement('div');
            resizeHandle.className = 'resize-handle';

            // Add rotate handle
            const rotateHandle = document.createElement('div');
            rotateHandle.className = 'rotate-handle';

            overlay.appendChild(img);
            overlay.appendChild(resizeHandle);
            overlay.appendChild(rotateHandle);
            canvasContainer.appendChild(overlay);

            // Add event listeners
            overlay.addEventListener('mousedown', selectElement);
            overlay.addEventListener('mousedown', startDrag);
            resizeHandle.addEventListener('mousedown', startResize);
            rotateHandle.addEventListener('mousedown', startRotate);
        }

        // Element selection
        function selectElement(e) {
            e.stopPropagation();
            
            // Remove selection from all elements
            document.querySelectorAll('.overlay-element').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Select this element
            selectedElement = e.currentTarget;
            selectedElement.classList.add('selected');
            document.getElementById('deleteBtn').disabled = false;
        }

        // Drag functionality
        function startDrag(e) {
            if (e.target.classList.contains('resize-handle') || e.target.classList.contains('rotate-handle')) return;
            
            isDragging = true;
            const rect = selectedElement.getBoundingClientRect();
            const containerRect = document.getElementById('canvasContainer').getBoundingClientRect();
            
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
        }

        function drag(e) {
            if (!isDragging || !selectedElement) return;
            
            const containerRect = document.getElementById('canvasContainer').getBoundingClientRect();
            let newX = e.clientX - containerRect.left - dragOffset.x;
            let newY = e.clientY - containerRect.top - dragOffset.y;
            
            // Keep within bounds
            newX = Math.max(0, Math.min(newX, containerRect.width - selectedElement.offsetWidth));
            newY = Math.max(0, Math.min(newY, containerRect.height - selectedElement.offsetHeight));
            
            selectedElement.style.left = newX + 'px';
            selectedElement.style.top = newY + 'px';
        }

        function stopDrag() {
            isDragging = false;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
        }

        // Resize functionality
        function startResize(e) {
            e.stopPropagation();
            isResizing = true;
            document.addEventListener('mousemove', resize);
            document.addEventListener('mouseup', stopResize);
        }

        function resize(e) {
            if (!isResizing || !selectedElement) return;
            
            const containerRect = document.getElementById('canvasContainer').getBoundingClientRect();
            const elementRect = selectedElement.getBoundingClientRect();
            
            let newWidth = e.clientX - elementRect.left;
            let newHeight = e.clientY - elementRect.top;
            
            // Maintain aspect ratio and minimum size
            newWidth = Math.max(30, Math.min(newWidth, 200));
            newHeight = newWidth; // Keep square
            
            selectedElement.style.width = newWidth + 'px';
            selectedElement.style.height = newHeight + 'px';
        }

        function stopResize() {
            isResizing = false;
            document.removeEventListener('mousemove', resize);
            document.removeEventListener('mouseup', stopResize);
        }

        // Rotate functionality
        function startRotate(e) {
            e.stopPropagation();
            isRotating = true;
            document.addEventListener('mousemove', rotate);
            document.addEventListener('mouseup', stopRotate);
        }

        function rotate(e) {
            if (!isRotating || !selectedElement) return;
            
            const elementRect = selectedElement.getBoundingClientRect();
            const centerX = elementRect.left + elementRect.width / 2;
            const centerY = elementRect.top + elementRect.height / 2;
            
            const angle = Math.atan2(e.clientY - centerY, e.clientX - centerX) * (180 / Math.PI);
            selectedElement.style.transform = `rotate(${angle}deg)`;
        }

        function stopRotate() {
            isRotating = false;
            document.removeEventListener('mousemove', rotate);
            document.removeEventListener('mouseup', stopRotate);
        }

        // Delete selected element
        function deleteSelected() {
            if (selectedElement) {
                selectedElement.remove();
                selectedElement = null;
                document.getElementById('deleteBtn').disabled = true;
            }
        }

        // Clear all overlays
        function clearAll() {
            document.querySelectorAll('.overlay-element').forEach(el => el.remove());
            selectedElement = null;
            document.getElementById('deleteBtn').disabled = true;
        }

        // Download meme
        function downloadMeme() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const canvasContainer = document.getElementById('canvasContainer');
            const userImage = document.getElementById('userImage');
            
            canvas.width = canvasContainer.offsetWidth;
            canvas.height = canvasContainer.offsetHeight;
            
            // Draw background image
            ctx.drawImage(userImage, 0, 0, canvas.width, canvas.height);
            
            // Draw overlays
            const overlays = document.querySelectorAll('.overlay-element');
            let loadedImages = 0;
            const totalImages = overlays.length;
            
            if (totalImages === 0) {
                // No overlays, just download the base image
                downloadCanvas(canvas);
                return;
            }
            
            overlays.forEach(overlay => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = function() {
                    const rect = overlay.getBoundingClientRect();
                    const containerRect = canvasContainer.getBoundingClientRect();
                    
                    const x = rect.left - containerRect.left;
                    const y = rect.top - containerRect.top;
                    const width = overlay.offsetWidth;
                    const height = overlay.offsetHeight;
                    
                    // Get rotation
                    const transform = overlay.style.transform;
                    const rotation = transform.match(/rotate\(([^)]+)\)/);
                    const angle = rotation ? parseFloat(rotation[1]) * (Math.PI / 180) : 0;
                    
                    // Draw with rotation
                    ctx.save();
                    ctx.translate(x + width/2, y + height/2);
                    ctx.rotate(angle);
                    ctx.drawImage(img, -width/2, -height/2, width, height);
                    ctx.restore();
                    
                    loadedImages++;
                    if (loadedImages === totalImages) {
                        downloadCanvas(canvas);
                    }
                };
                img.src = overlay.querySelector('img').src;
            });
        }

        function downloadCanvas(canvas) {
            const link = document.createElement('a');
            link.download = 'methamphetameme-meme.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        // Click outside to deselect
        document.getElementById('canvasContainer').addEventListener('click', function(e) {
            if (e.target === this) {
                document.querySelectorAll('.overlay-element').forEach(el => {
                    el.classList.remove('selected');
                });
                selectedElement = null;
                document.getElementById('deleteBtn').disabled = true;
            }
        });
    </script>
</body>
</html>